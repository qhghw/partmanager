<?xml version="1.0" encoding="utf-8"?>
<body name="body" class="sys_normal" headerScript="var  operateType,model_id;">
	<folder name="store"><extAjax name="addRequest" out="extWindow" url="main?action=webbuilder/application/partmanager/workflow/store/save.xwl" onSuccess="var respText = Ext.util.JSON.decode(response.responseText);   &#xA;extWindow.hide();     &#xA;var modelkey=respText.key;&#xA;Get('iframe').src='/PartManager/service/editor?id='+modelkey;&#xA;designWindow.show();" in="key_"/><extStore name="select" autoLoad="true" url="main?action=webbuilder/application/partmanager/workflow/store/select.xwl"/><extAjax name="ajaxDeploy" url="main?action=webbuilder/application/partmanager/workflow/store/deploy.xwl" onSuccess="extShowMessage('部署成功！');" onFailure="extShowMessage('部署失败！');" out="modelgrid"/><extAjax name="ajaxDelete" url="main?action=webbuilder/application/partmanager/workflow/store/delete.xwl" out="modelgrid" onSuccess="extShowMessage('删除成功！');select.reload();" onFailure="extShowMessage('删除失败！');"/><extStore name="selectnode" url="main?action=webbuilder/application/partmanager/workflow/store/nodelist.xwl" fields="{name:'nodename'},{name:'nodekey'},{name:'usertype'},{name:'nodeuser'},{name:'proc_def_id'}"/><method methodName="com.xuelang.partmanage.MultipleTree.getUserRoleTree" name="userorrolelist_"/><extAjax name="ajaxSave" url="main?action=webbuilder/application/partmanager/workflow/store/ajaxSave.xwl" out="userSetWindow"/></folder><folder name="column"><extComboBox mode="local" name="nodetype" displayField="KEY_TEXT" valueField="KEY_ID" autoShow="false" mapKey="ASSIGNEE"/><extComboTree data="{#userRoleTree#}" onClick="var sm = usergrid.getSelectionModel();&#xA;var celIndex = sm.getSelectedCell();&#xA;var record = usergrid.getStore().getAt(celIndex [0]);&#xA;var usertype_=record.get('usertype') ;&#xA;if(usertype_==1){&#xA;if(node.leaf){&#xA;var text=node.text;&#xA;nodeuser.setValue(text);&#xA;nodeuser.collapse();&#xA;}&#xA;}else{&#xA;if(!node.leaf){&#xA;var text=node.text;&#xA;nodeuser.setValue(text);&#xA;nodeuser.collapse();&#xA;};&#xA;}" name="nodeuser" autoShow="false" width="200"/><extColumnModel name="columnModel"><extColumn name="_key" caption="编号" fieldName="key_" width="100" align="center"/><extColumn name="_version" caption="版本号" fieldName="version" width="100" align="center"/><extColumn name="_create_time" caption="创建日期" fieldName="create_time" width="200" align="center"/><extColumn name="_last_update_time" fieldName="last_update_time" caption="修改日期" align="center" width="200"/><extColumn name="_name" caption="名称" fieldName="name_" width="200" align="center"/><extColumn caption="caption" name="_id" hidden="true" fieldName="id"/></extColumnModel><extColumnModel name="columnNode"><extColumn caption="任务节点名称" name="_nodename" fieldName="nodename"/><extColumn name="_nodekey" caption="节点key" fieldName="nodekey" hidden="true"/><extColumn name="_usertype" caption="办理方式" fieldName="usertype" editor="nodetype" renderer="if(value==1){&#xA;return '办理人';&#xA;}else if(value==2){&#xA;return '办理组';&#xA;}"/><extColumn name="_nodeuser" fieldName="nodeuser" caption="办理人（组）选择" editor="nodeuser" width="200"/><extColumn name="_proc_def_id" fieldName="proc_def_id" caption="流程key" hidden="true"/></extColumnModel></folder><folder name="menu"><extMenu name="flowdesignmenu"><extMenuItem name="search" caption="查询" iconCls="icon_property" onClick="select.reload();"/><extMenuItem name="add" caption="增加" onClick="extWindow.setTitle('新增');&#xA;extWindow.show();&#xA;operateType = 'insert';&#xA;extResetAllControlsValue(&quot;extWindow&quot;);" iconCls="icon_new"/><extMenuItem name="del" caption="删除" iconCls="icon_delete" onClick="operateType = 'modify';&#xA;if (modelgrid.getSelectionModel().getSelections().length != 1)&#xA;{&#xA;	extShowWarning('请选择一条数据。');&#xA;	return;&#xA;}else{	&#xA;	var record = modelgrid.getSelectionModel().getSelected();&#xA;	ajaxDelete();&#xA;&#xA;}"/><extMenuItem name="edit" caption="修改" iconCls="icon_edit" onClick="operateType = 'modify';&#xA;if (modelgrid.getSelectionModel().getSelections().length != 1)&#xA;{&#xA;	extShowWarning('请选择一条数据。');&#xA;	return;&#xA;}else{	&#xA;	var record = modelgrid.getSelectionModel().getSelected();&#xA;	var modelkey=record.data.id;&#xA;	Get('iframe').src='/PartManager/service/editor?id='+modelkey;&#xA;	designWindow.show();&#xA;&#xA;}"/><extMenuItem onClick="userSetWindow.setTitle('设置用户');&#xA;userSetWindow.show();" iconCls="icon_new" name="setuser" caption="设置用户"/><extMenuItem name="deployment" caption="部署" iconCls="icon_property" onClick="operateType = 'modify';&#xA;if (modelgrid.getSelectionModel().getSelections().length != 1)&#xA;{&#xA;	extShowWarning('请选择一条数据。');&#xA;	return;&#xA;}else{	&#xA;	var record = modelgrid.getSelectionModel().getSelected();&#xA;	ajaxDeploy();&#xA;}"/></extMenu><extMenu name="nodeusermenu"><extMenuItem name="save" caption="保存" onClick="ajaxSave();" iconCls="icon_save"/></extMenu></folder><folder name="script"/><folder name="window"><extWindow name="extWindow" closeAction="hide" frame="true" width="500" height="253" layout="absolute" caption="流程编辑窗口" onOk="if (!extVerifyAllControls('extWindow')) return;&#xA;&#xA;if (operateType == 'insert'){&#xA;&#xA;addRequest();&#xA;} else&#xA;{&#xA;  //这里写UPDATE的方法&#xA;}"><extLabel left="40" top="60" caption="流程名称:" name="nameLabel" width="90"/><extTextField left="165" top="55" width="275" name="name_"/><extLabel name="keyLabel" left="40" top="30" caption="流程编号:" width="90"/><extTextField left="165" top="25" width="275" name="key_"/><extLabel name="descLabel" left="40" top="120" width="90" caption="流程描述"/><extTextField left="165" top="85" width="275" name="description" inputType="textArea" height="85"/></extWindow><extWindow closeAction="hide" frame="true" name="designWindow" caption="模型设置" region="center" width="100%" layout="absolute" height="500"><iframe name="iframe" width="100%" height="100%"/></extWindow><extWindow name="userSetWindow" closeAction="hide" frame="true" width="500" height="350" caption="用户设置" layout="border" onShow="var record = modelgrid.getSelectionModel().getSelected();&#xA;model_id=record.data.id;&#xA;selectnode.baseParams.model_id=model_id;&#xA;selectnode.load();&#xA;modelid.setValue(model_id);" dialog="false"><extPanel border="false" layout="fit" region="center" width="400" autoScroll="true" height="400" left="10" top="40" name="nodeListpanel"><extGrid name="usergrid" pageSize="15" columnsModel="columnNode" region="center" canEdit="true" submitMode="modified" loadStore="false" store="selectnode" tbar="nodeusermenu"/><extTextField name="modelid" hidden="true"/></extPanel></extWindow></folder><extViewPort name="viewPort" layout="border"><extGrid name="modelgrid" store="select" loadStore="true" columnsModel="columnModel" pageSize="15" region="center" tbar="flowdesignmenu" width="100%" height="100%"/></extViewPort></body>
