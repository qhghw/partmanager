<?xml version="1.0" encoding="utf-8"?>
<body name="body" class="sys_normal" caption="非我司代理船维护" needLogin="false" extLastScript="var d=new Date();&#xA;Ext.getCmp('edDate').setValue(d.getDate()+15);&#xA;d.setDate(d.getDate()-10);&#xA;Ext.getCmp('bgDate').setValue(d);&#xA;&#xA;shipGridstore.baseParams.WhereSql =&quot; AND 1=2&quot;;" headerScript="var rowIn;">
	<folder name="ExtScriptFolder"><extScript name="extScript" header="var t3 = '';&#xA;function strSplit(_str){&#xA;	if(_str.indexOf(&quot;(&quot;) &gt; 0 )  &#xA;	{&#xA;		var strArray1 = _str.split(&quot;(&quot;)&#xA;		if (strArray1.length &gt; 1 )&#xA;		{&#xA;			if(strArray1[1].indexOf(&quot;)&quot;) &gt; 0 )  &#xA;			{&#xA;			   var strArray2 = strArray1[1].split(&quot;)&quot;)&#xA;			   if(strArray2[0].indexOf(&quot;-&quot;) &gt; 0 )&#xA;			   {&#xA;				var strArray3 = strArray2[0].split(&quot;-&quot;)&#xA;				return strArray3;&#xA;			   }&#xA;			}&#xA;		}&#xA;	}	&#xA;	return _str;&#xA;}&#xA;&#xA;&#xA;&#xA;function strSplitChar(_str,_char){&#xA;	if(_str.indexOf(&quot;(&quot;) &gt; 0 )  &#xA;	{&#xA;		var strArray1 = _str.split(&quot;(&quot;)&#xA;		if (strArray1.length &gt; 1 )&#xA;		{&#xA;			if(strArray1[1].indexOf(&quot;)&quot;) &gt; 0 )  &#xA;			{&#xA;			   var strArray2 = strArray1[1].split(&quot;)&quot;)&#xA;			   if(strArray2[0].indexOf(_char) &gt; 0 )&#xA;			   {&#xA;				var strArray3 = strArray2[0].split(_char)&#xA;				return strArray3;&#xA;			   }&#xA;			}&#xA;		}&#xA;	}	&#xA;	return _str;&#xA;}"/></folder><folder name="folderStore"><extStore name="shipGridstore" url="main?action=webbuilder/application/ship/shipwork/ShipEditShipGridStore.xwl" onAfterLoad="grid.getSelectionModel().selectRow(rowIn);"/><extStore name="vesselStore" url="main?action=webbuilder/application/ship/common/vesselSelect.xwl"/><extStore name="lineStore" url="main?action=webbuilder/application/ship/common/arealineSelect.xwl"/><extStore name="berthStore" url="main?action=webbuilder/application/ship/common/berthSelect.xwl"/><extStore name="trustStore" url="main?action=webbuilder/application/ship/common/trustSelect.xwl"/><extAjax url="main?action=webbuilder/application/ship/shipwork/ShipEditShipSave.xwl" out="extWindow" onSuccess="alert(&quot;保存成功！&quot;);shipGridstore.reload();" onFailure="alert(&quot;保存失败&quot;);" name="updateAjax"/><extAjax out="grid" onSuccess="alert(&quot;成功&quot;);shipGridstore.reload();" onFailure="alert(&quot;失败&quot;);" name="deleteRequest" url="main?action=webbuilder/application/ship/shipwork/ShipEditShipDelete.xwl"/></folder><folder name="folderColumn"><extColumnModel name="columnMode_Ship"><extScript name="extScript1" extHeader="new Ext.grid.CheckboxSelectionModel()"/><extColumn caption="英文船名" fieldName="E_SHIP_NAM" name="E_SHIP_NAMc" align="left" width="100"/><extColumn caption="中文船名" fieldName="C_SHIP_NAM" name="C_SHIP_NAMc" align="left"/><extColumn caption="进口航次" fieldName="IN_VOYAGE_NO" name="IN_VOYAGE_NOc" align="left" width="60"/><extColumn caption="出口航次" fieldName="OUT_VOYAGE_NO" name="OUT_VOYAGE_NOc" align="left" width="60"/><extColumn caption="预抵时间" fieldName="ETA_TIM" name="ETA_TIMc" align="left" width="120" renderer="return value.format('Y-m-d H:i');" type="datetime"/><extColumn caption="预离时间" fieldName="ETD_TIM" name="ETD_TIMc" align="left" width="120" renderer="return value.format('Y-m-d H:i');" type="datetime"/><extColumn caption="航线名称" fieldName="LINE_NAM" name="LINE_NAMc" align="left" width="60"/><extColumn caption="预抵位置" fieldName="ETA_PLACE_STR" name="ETA_PLACE_STRc" align="left"/><extColumn fieldName="TRADE_ID" name="TRADE_IDc" caption="内贸？" align="left" renderer="if(value=='1'){return '内贸';}&#xA;else if(value=='0'){return '外贸';}" width="40"/><extColumn caption="船舶档案号" fieldName="SHIP_ARCH_NBR" name="SHIP_ARCH_NBRc" align="left"/><extColumn caption="船舶海关码" fieldName="SHIP_CUSTOM_NBR" name="SHIP_CUSTOM_NBRc" align="left"/><extColumn caption="船舶海事局编号" fieldName="SHIP_MSA_NBR" name="SHIP_MSA_NBRc" align="left"/><extColumn caption="船舶编号" fieldName="SHIP_NO" name="SHIP_NOc" align="left"/></extColumnModel></folder><folder name="folder"><extWindow name="extWindow" closeAction="hide" frame="true" width="743" height="430" layout="absolute" caption="非我司代理船舶明细" onOk="if(SHIP_COD.getValue()==''){&#xA;	extShowMessage('船舶代码不能为空');&#xA;	return;&#xA;}&#xA;if(E_SHIP_NAM.getValue()==''){&#xA;	extShowMessage('英文船名不能为空');&#xA;	return;&#xA;}&#xA;&#xA;if(C_SHIP_NAM.getValue()==''){&#xA;	extShowMessage('中文船名不能为空');&#xA;	return;&#xA;}&#xA;&#xA;if(IN_VOYAGE_NO.getValue()==''){&#xA;	extShowMessage('进口航次不能为空');&#xA;	return;&#xA;}&#xA;&#xA;if(OUT_VOYAGE_NO.getValue()==''){&#xA;	extShowMessage('出口航次不能为空');&#xA;	return;&#xA;}&#xA;if(FIVE_VOYAGE_Y.getValue()==''){&#xA;	extShowMessage('五日船期强入标志不能为空');&#xA;	return;&#xA;}&#xA;&#xA;if(ETD_TIM.getValue()==''){&#xA;	extShowMessage('预离时间不能为空');&#xA;	return;&#xA;}&#xA;if(ETA_TIM.getValue()==''){&#xA;	extShowMessage('预抵时间不能为空');&#xA;	return;&#xA;}&#xA;&#xA;if (ETD_TIM.getValue() &lt; ETA_TIM.getValue())&#xA;{&#xA;extShowMessage('预抵时间不能晚于预离时间！');&#xA;	return;&#xA;}&#xA;rowIn=grid.store.indexOf(grid.getSelectionModel().getSelected());&#xA;&#xA;updateAjax();"><extLabel name="extLabel" left="10" top="10" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;船舶编码："/><extLabel name="extLabel1" left="10" top="40" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;英文船名："/><extLabel name="extLabel2" left="10" top="70" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;中文船名："/><extLabel name="extLabel3" left="10" top="100" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;进口航次："/><extLabel name="extLabel4" left="10" top="130" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;出口航次："/><extLabel name="extLabel5" left="10" top="160" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;预抵时间："/><extLabel name="extLabel6" left="10" top="190" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;预离时间："/><extLabel name="extLabel7" left="10" top="220" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;抵港时间："/><extLabel name="extLabel8" left="10" top="250" width="80" caption="靠泊时间："/><extLabel name="extLabel9" left="10" top="280" width="80" caption="开航时间："/><extLabel name="extLabel10" left="10" top="310" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;加入船期："/><extLabel name="extLabel11" left="10" top="340" width="80" html="&lt;font color='red'&gt;*&lt;/font&gt;是否代理："/><extDate left="100" top="155" width="145" name="ETA_TIM" format="Y-m-d H:i" tag="tabIndex:60"/><extDate left="100" top="185" width="145" name="ETD_TIM" format="Y-m-d H:i" tag="tabIndex:70"/><extDate left="100" top="215" width="145" name="ARRIV_PORT_TIM" format="Y-m-d H:i" tag="tabIndex:80"/><extDate left="100" top="245" width="145" name="TO_BERTH_TIM" format="Y-m-d H:i" tag="tabIndex:90"/><extDate left="100" top="275" width="145" name="SHIP_LEAV_PORT_TIM" format="Y-m-d H:i" tag="tabIndex:100"/><extLabel name="extLabel12" left="400" top="10" width="55" caption="泊位号："/><extLabel name="extLabel13" left="380" top="40" width="75" caption="中文泊位名："/><extLabel name="extLabel14" left="380" top="70" width="75" caption="卸货作业区："/><extLabel name="extLabel15" left="380" top="100" width="75" caption="装货作业区："/><extLabel name="extLabel16" left="380" top="130" width="75" caption="航线代码："/><extLabel name="extLabel17" left="380" top="160" width="75" caption="呼号："/><extLabel name="extLabel18" left="380" top="190" width="75" caption="委托方代码："/><extLabel name="extLabel19" left="370" top="220" width="85" caption="委托方英文名："/><extLabel name="extLabel20" left="375" top="250" width="80" caption="更改备注："/><extLabel name="extLabel21" left="370" top="280" width="85" caption="订仓截止时间："/><extLabel name="extLabel22" left="390" top="310" width="65" caption="录入时间："/><extLabel name="extLabel23" left="390" top="340" width="65" caption="录入员：" align="right"/><extComboBox mode="local" left="480" top="5" width="145" name="BERTH_NO" store="berthStore" displayField="BERTHNAM" valueField="BERTHNAM" pageSize="20" listWidth="200" mustSelection="false" forceSelection="true" typeAhead="true" minChars="3" onSelect="var v = extGetComboValue(BERTH_NO);&#xA;if(v!=null)&#xA;{&#xA;Ext.getCmp(&quot;BERTH_NO_CHN&quot;).setValue(strSplit(v)[1]);&#xA;Ext.getCmp(&quot;BERTH_NO&quot;).setValue(strSplit(v)[0]);&#xA;}" tag="tabIndex:130"/><extTextField left="480" top="35" width="145" name="BERTH_NO_CHN" tag="tabIndex:140"/><extTextField left="480" top="65" width="145" name="DETT_COD" tag="tabIndex:150"/><extTextField left="480" top="95" width="145" name="LETT_COD" tag="tabIndex:160"/><extTextField left="480" top="155" width="145" name="CALL_NO" tag="tabIndex:180"/><extTextField left="480" top="245" width="145" name="CHANGE_REMARK" tag="tabIndex:210"/><extDate left="480" top="275" width="145" name="IFTMBF_END_TIM" format="Y-m-d H:i" tag="tabIndex:220"/><extDate left="480" top="305" width="145" format="Y-m-d H:i" name="RECORD_TIM" tag="tabIndex:230"/><extTextField left="480" top="335" width="145" name="RECORD_MAN" tag="tabIndex:240"/><extComboBox mode="local" left="100" top="305" width="145" mapKey="ISYESORNO" displayField="KEY_TEXT" valueField="KEY_ID" name="SHIP_REPORT_ID" tag="tabIndex:110"/><extComboBox mode="local" left="100" top="5" width="145" name="SHIP_COD" store="vesselStore" displayField="VESSELS" valueField="VESSELS" pageSize="20" listWidth="300" mustSelection="false" forceSelection="true" typeAhead="true" minChars="3" onSelect="var v = extGetComboValue(SHIP_COD);&#xA;if(v!=null)&#xA;{&#xA;Ext.getCmp(&quot;SHIP_COD&quot;).setValue(strSplit(v)[2]);&#xA;Ext.getCmp(&quot;C_SHIP_NAM&quot;).setValue(strSplit(v)[1]);&#xA;Ext.getCmp(&quot;E_SHIP_NAM&quot;).setValue(strSplit(v)[0]);&#xA;}" tag="tabIndex:10"/><extTextField left="100" top="35" width="145" name="E_SHIP_NAM" tag="tabIndex:20" maxLength="50"/><extTextField left="100" top="95" width="145" name="IN_VOYAGE_NO" tag="tabIndex:40" maxLength="10"/><extTextField left="100" top="125" width="145" name="OUT_VOYAGE_NO" maxLength="10" tag="tabIndex:50"/><extTextField left="100" top="65" width="145" name="C_SHIP_NAM" tag="tabIndex:30" maxLength="50"/><extComboBox mode="local" left="100" top="335" width="145" mapKey="ISYESORNO" displayField="KEY_TEXT" valueField="KEY_ID" name="AGENCY_ID" tag="tabIndex:120"/><extComboBox mode="local" left="480" top="125" width="145" name="LINE_COD" store="lineStore" displayField="LINENAM" valueField="LINENAM" pageSize="15" listWidth="300" onSelect="var v = extGetComboValue(LINE_COD);&#xA;if(v!=null)&#xA;{&#xA;Ext.getCmp(&quot;LINE_COD&quot;).setValue(strSplit(v)[0]);&#xA;}" tag="tabIndex:170"/><extComboBox mode="local" left="480" top="185" width="145" name="TRUST_COD" store="trustStore" displayField="TRUST_COD" valueField="TRUST_COD" pageSize="20" listWidth="300" onSelect="var v = extGetComboValue(TRUST_COD);&#xA;{&#xA;control.setValue(strSplitChar(v,&quot;*&quot;)[2]);&#xA;Ext.getCmp(&quot;E_TRUST_NAM&quot;).setValue(strSplitChar(v,&quot;*&quot;)[1]);&#xA;}" mustSelection="false" forceSelection="true" typeAhead="true" tag="tabIndex:190"/><extTextField left="480" top="215" width="145" name="E_TRUST_NAM" tag="tabIndex:200"/><extTextField left="270" top="330" width="65" name="tableName" value="SHIP" hidden="true"/><extTextField left="270" top="305" width="60" name="SHIP_NO" hidden="true"/><extTextField left="270" top="280" width="75" name="OLD_SHIP_NO" hidden="true"/><extTextField left="270" top="250" width="75" name="SHIP_STAT_ID" hidden="true"/><extTextField left="275" top="225" width="55" name="TL_ID" hidden="true" value="L"/><extTextField left="265" top="195" width="70" name="TRADE_ID" value="1" hidden="true"/><extTextField left="265" top="160" width="85" name="FIVE_VOYAGE_Y" value="1" hidden="true"/><extTextField left="265" top="125" width="90" name="BERTH_REQ_ID" value="1" hidden="true"/><extTextField left="270" top="90" width="120" name="BL_SHIPCARD_PRT_ID" value="1" hidden="true"/></extWindow><extMenu name="menu1"><extMenuItem name="menuItem3" caption="预抵时间："/><extDate name="bgDate" format="Y-m-d"/><extMenuItem name="menuItem4" caption="|"/><extDate name="edDate" format="Y-m-d"/><extMenuItem name="menuItemQuery" caption="查询" iconCls="icon_find" onClick="var beginDate =  Ext.getCmp('bgDate').getValue().format('Y-m-d') ;&#xA;var endDate =  Ext.getCmp('edDate').getValue().format('Y-m-d') ;&#xA;if (IsEmpty(beginDate ))&#xA;{&#xA;  extShowMessage('请选择开始时间');&#xA; return;&#xA;}&#xA;if (IsEmpty(endDate ))&#xA;{&#xA;  extShowMessage('请选择结束时间');&#xA; return;&#xA;}&#xA;rowIn=grid.store.indexOf(grid.getSelectionModel().getSelected());&#xA;shipGridstore.baseParams.WhereSql = &quot;  AND AGENCY_ID='0' AND ( TO_CHAR(ETA_TIM,'yyyy-mm-dd') &gt;= '&quot;+beginDate+&quot;' AND TO_CHAR(ETA_TIM,'yyyy-mm-dd') &lt;= '&quot;+endDate+&quot;')&quot;;&#xA;shipGridstore.load({params:{start:0,limit:30}});"/><extMenuItem name="menuItemFill" caption="caption" menuType="fill"/><extMenuItem name="menuItemAdd" caption="增加" onClick="extWindow.setTitle('新增非我司船舶');&#xA;extWindow.show();&#xA;extResetAllControlsValue(&quot;extWindow&quot;);&#xA;tableName=Ext.getCmp(&quot;tableName&quot;);&#xA;           tableName.setValue(&quot;SHIP&quot;)&#xA;AGENCY_ID=Ext.getCmp(&quot;AGENCY_ID&quot;);&#xA;           AGENCY_ID.setValue(&quot;0&quot;)&#xA;SHIP_STAT_ID = Ext.getCmp(&quot;SHIP_STAT_ID&quot;);&#xA;           SHIP_STAT_ID.setValue(&quot;3&quot;)&#xA;&#xA;BERTH_REQ_ID = Ext.getCmp(&quot;BERTH_REQ_ID&quot;);&#xA;           BERTH_REQ_ID.setValue(&quot;1&quot;)&#xA;BL_SHIPCARD_PRT_ID = Ext.getCmp(&quot;BL_SHIPCARD_PRT_ID&quot;);&#xA;           BL_SHIPCARD_PRT_ID.setValue(&quot;1&quot;)&#xA;FIVE_VOYAGE_Y = Ext.getCmp(&quot;FIVE_VOYAGE_Y&quot;);&#xA;           FIVE_VOYAGE_Y.setValue(&quot;1&quot;)&#xA;TRADE_ID = Ext.getCmp(&quot;TRADE_ID&quot;);&#xA;           TRADE_ID.setValue(&quot;1&quot;)&#xA;TL_ID = Ext.getCmp(&quot;TL_ID&quot;);&#xA;          TL_ID.setValue(&quot;L&quot;)&#xA;operateType = 'insert';&#xA;&#xA;RECORD_MAN.setValue('{#sys.username#}');&#xA;RECORD_TIM.setValue('{#sys.nowdate#}');" iconCls="icon_new"/><extMenuItem name="menuItemEdit" caption="修改" iconCls="icon_edit" onClick="operateType = 'modify';&#xA;grid=Ext.getCmp(&quot;grid&quot;);&#xA;if (grid.getSelectionModel().getSelections().length != 1)&#xA;{&#xA;	extShowWarning('请选择一个有效的条目。');&#xA;	return;&#xA;}else{&#xA;	var record = grid.getSelectionModel().getSelected();&#xA;		extWindow.show();&#xA;	extSetAllControlsValueObj(extWindow, record.data);&#xA;&#xA;}"/><extMenuItem name="menuItemDelete" caption="删除" iconCls="icon_delete" onClick="grid=Ext.getCmp(&quot;grid&quot;);&#xA;extGridDeleteConfirm(grid,&quot;C_SHIP_NAM&quot;,function(){&#xA;	deleteRequest();&#xA;});"/></extMenu></folder><extViewPort name="viewPort" layout="border"><extGrid name="grid" region="center" columnsModel="columnMode_Ship" tbar="menu1" store="shipGridstore" loadStore="false" pageSize="30"/></extViewPort></body>
